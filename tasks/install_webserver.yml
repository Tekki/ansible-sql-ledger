---

- name: install httpd
  apt: name={{ item }} state=latest
  with_items:
    - apache2

- name: copy site config
  template: src=sql-ledger.httpd.conf  dest=/etc/apache2/sites-available/{{ httpd_url }}.conf
  notify:
    - reload apache2

- name: check if site is activated
  command: a2query -s {{ httpd_url }}
  ignore_errors: true
  register: sitequery

- name: activate site
  command: a2ensite {{ httpd_url }}
  when: sitequery|failed
  notify:
    - reload apache2

- name: enable cgid module
  apache2_module: name=cgid state=present
  notify:
    - restart apache2
